# myshell

### 一. 功能概览

myshell支持以下命令及功能：

* pwd：显示当前工作目录

* cd：修改当前工作目录

* clr，clear：清屏

* exit，quit：退出myshell

* time：显示当前时间

* echo：在屏幕上显示内容并换行

* 调用外部命令（子命令包含环境变量parent=\<shellpath\>/myshell）

* 后台执行命令符号：&

* jobs：输出后台作业列表

* fg：将后台作业移至前台运行

* bg：使后台暂停的作业继续运行

* exec：运行目标程序替代当前进程

* environ：输出环境变量

* help：输出用户手册（使用more过滤）

* set：设置命令行参数变量$1-$9的值

* shift：移动命令行参数的位置

* 基于test的if语句（不支持else）

* umask：修改文件创建权限掩码

* unset：清除变量值

* 同一行使用;分隔多个命令

* 输入重定向：\<   输出重定向： \> 和 \>\>

* 管道 | 

* 从文件中提取命令行输入

* 命令行提示符显示用户名、主机名和当前工作目录；其中当前工作目录中主目录的路径以~替代

* 用户自定义变量（字符串类型）、实现变量赋值（包括已有环境变量赋值）

* 引用变量值（仅支持使用$引用变量，暂不支持${}）

### 二. 功能说明

**2.1 pwd**

格式：pwd

说明：pwd命令没有参数。直接在命令行键入pwd命令，即可输出当前工作目录。

**2.2 cd**

格式：cd \<directory\>

说明：通过cd \<directory\>命令将当前工作目录修改为\<directory\>。cd命令除了支持绝对路径外，也支持“~”，“.”，“..”三种相对路径符号和“$HOME”变量引用。

**2.3 clear**和**clr**

格式：clear

格式：clr

说明：clear和clr作用完全相同，均为清屏。该命令没有参数。

**2.4 quit**和**exit**

格式：quit

格式：exit

说明：quit和exit作用完全相同，均为退出myshell。该命令没有参数。

**2.5 time**

格式：time

说明：time命令用于显示当前时间。该命令没有参数。

**2.6 echo**

格式：echo \<comment\>

说明：输出comment到屏幕，也可以重定向。echo命令输出的时候会将多个空白字符（空格、\t等）缩减为一个空格。

**2.7** **外部命令**

格式：command

说明：创建新进程并执行程序。新进程会作为myshell的子进程运行，同时新进程包含环境变量parent=\<shellpath\>/myshell。

**2.8 &** 

格式：\<command\> &

说明：在命令行后面加&，可在后台运行。注意&和命令之间必须有空格。

**2.9 jobs**

格式：jobs

说明：输出后台作业列表及状态。该命令没有参数。

**2.10 fg**

格式：

a)    fg

b)    fg %作业号

c)    fg 作业号

d)    fg %命令名

e)    fg 命令名

f)    fg + 或 fg %+

g)    fg – 或 fg %-

说明：fg的作用是将后台运行的进程组转至前台处理。当无参数时（a）情况）将当前作业（jobs中带“+”的）转至前台。其余情况可以将对应的作业转至前台。若不存在相应作业则会报错。

**2.11 bg**

格式：

a)    bg

b)    bg %作业号

c)    bg 作业号

d)    bg %命令名

e)    bg 命令名

f)    bg + 或 fg %+

g)    bg – 或 fg %-

说明：bg可以使后台暂停运行的程序在后台继续运行。其使用方法与fg相同。

**2.12 exec**

格式：exec \<command\>

说明：运行目标程序\<command\>取代当前进程。

**2.13 environ**

格式：environ

说明：显示环境变量列表。该命令没有参数。

**2.14 help**

格式：help \<command\>

说明：调用man命令显示\<command\>的用户手册并使用more过滤。

**2.15 set**

格式：set param1 param2 … param 9

说明：set用于将命令行参数$1-$9设置为param1 – param9，若提供的参数不足9个，则会将后面的参数置为NULL（空）。

**2.16 shift**

格式 shift 或 shift \<num\>

说明：shift用于将命令行参数$1-$9左移\<num\>个位置。若不提供参数则默认移动1位。被移走的参数原位置置空（NULL）。

**2.17** **基于test的if语句**

格式：if test \<expression\>; then

\<commands\>

fi

说明：if语句根据test表达式的真值判断是否执行中间的语句，其中表达式必须以test开头。test支持的表达式类型如下：

| 文件测试     | 整数测试           | 字符串测试    |                      |                             |                      |
| ------------ | ------------------ | ------------- | -------------------- | --------------------------- | -------------------- |
| -f filename  | 文件是否存在       | int1 -eq int2 | 整数是否相等         | str                         | str是否为非空字符串  |
| -r filename  | 文件是否为只读文件 | int1 -ne int2 | 整数是否不相等       | -z str                      | str长度是否为0       |
| -x filename  | 文件是否可执行     | int1 -le int2 | int1是否小于等于int2 | -n str                      | str长度是否不为0     |
| -w filename  | 文件是否可写       | int1 -lt int2 | int1是否小于int2     | str1 == str2  或str1 = str2 | str1和str2是否相等   |
| -d directory | 目录是否存在       | int1 -ge int2 | int1是否大于等于int2 | str1 != str2                | str1和str2是否不相等 |
|              |                    | int1 -gt int2 | int1 是否大于int2    | str1 \\< str2               | str1是否小于str2     |
|              |                    |               |                      | str1 \\> str2               | str1是否大于str2     |

**2.18** **umask**

格式：umask 或umask \<num\>

说明：umask用于获取或修改文件权限掩码。当umask没有参数时，获取当前的umask值；当umask有参数num时，将umask值修改为num，注意num为(0)­8 ~ (777)8之间的8进制数。

**2.19 unset**

格式：unset \<variable\>

说明：unset命令可将\<variable\>变量置空，\<variable\>可以是命令行参数变量或用户定义的变量。

**2.20** **命令行中的“;”**

格式：\<command1\> ; \<command2\> ; … ; \<commandn\>

说明：在shell中的同一行输入引号;，可以将同一行的内容分割成多个命令运行。注意引号和前后命令之间必须有空格。一行中的最后一个命令末尾可以有引号也可以没有。

**2.21** **输入输出重定向**

格式：

输出重定向：\<command\> \> \<outputfile\>

输入重定向 \<command\> \< \<inputfile\>

输出重定向（内容增加到文件末） \<command\> \>\> \<outputfile\>

说明：“\<”“\>”“\>\>”用于实现输入和输出的重定向，能将输入或输出的文件从标准输入输出修改为特定的文件。其中，输入重定向与两种输出重定向可以混合使用，且无先后顺序限制；两种输出重定向方式不能同时使用。使用时请不要忘记空格。**注意：若管道和输入输出重定向发生冲突，则重定向有更高的优先级，此时混用管道和重定向可能会发生错误结果，请避免这种使用方法。**

**2.22** **管道** **|**

格式：\<command1\> | \<command2\> | \<command3\> | … | \<commandn\>

说明：使用管道连接多条命令，可以使上一条命令的输出作为下一条命令的输入。管道符号和命令之间需要加空格。

**2.23** **从文件中提取命令行输入**

格式：myshell \<scriptfile\>

说明：在运行myshell时加上脚本文件的路径作为参数，可以让myshell从脚本文件中读取命令并执行。这种调用方法可以在myshell中使用，也可以直接在bash中使用。在bash中使用时myshell的目录并不在环境变量中，因此调用时要加上myshell的路径。注意文件中的脚本语法必须符合myshell的命令语法。

**2.24** **命令行提示符：**

格式：\<username\>@\<hostname\>:\<working directory\>$

说明：命令行提示符显示用户名、主机名和当前工作目录；其中当前工作目录中主目录的路径以~替代。用户名和主机名以青色显示，工作目录以紫色显示，提示符$以白色显示。

**2.25** **用户自定义变量（环境变量赋值）**

格式：\<varname\> = \<value\>

说明：用户自定义变量以字符串格式存储。执行上述赋值语句，即可创建变量名为\<varname\>的新变量。**注意：**赋值语句的赋值号“=”与前后变量名与变量必须以空格分开。**该语句也可用于修改环境变量的值**

**2.26** **变量引用**

格式：$varname

说明：在变量名之前加$符号，可以在语句解析阶段将变量名替换为变量的值。该方法适用于用户自定义的变量、环境变量和命令行参数。未被定义过的参数将被解析成空值。变量解析目前只适用于将命令行参数的一整项作为变量名解析，暂不支持${}的解析方式，也不支持在一个长字符串中截取部分作变量名解析。
